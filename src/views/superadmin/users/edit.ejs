<!-- Edit User Form -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2><i class="fas fa-user-edit me-2"></i> Edit Pengguna</h2>
  <a href="/superadmin/users" class="btn btn-outline-secondary">
    <i class="fas fa-arrow-left me-1"></i> Kembali ke Daftar Pengguna
  </a>
</div>

<div class="card">
  <div class="card-header bg-white">
    <div class="d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Edit Data Pengguna</h5>
      <span class="badge bg-<%= user.role === 'superadmin' ? 'danger' : (user.role === 'admin' ? 'warning' : 'info') %>">
        <%= user.role %>
      </span>
    </div>
  </div>
  <div class="card-body">
    <form action="/superadmin/users/<%= user.id %>/update" method="POST" novalidate class="needs-validation">
      <!-- Full Name -->
      <div class="mb-3">
        <label for="fullName" class="form-label">Nama Lengkap <span class="text-danger">*</span></label>
        <input type="text" class="form-control <%= locals.errors && errors.fullName ? 'is-invalid' : '' %>" 
              id="fullName" name="fullName" value="<%= locals.formData ? formData.fullName : user.fullName %>" required>
        <% if (locals.errors && errors.fullName) { %>
          <div class="invalid-feedback"><%= errors.fullName.message %></div>
        <% } %>
      </div>
      
      <!-- Email -->
      <div class="mb-3">
        <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
        <input type="email" class="form-control <%= locals.errors && errors.email ? 'is-invalid' : '' %>" 
              id="email" name="email" value="<%= locals.formData ? formData.email : user.email %>" required>
        <% if (locals.errors && errors.email) { %>
          <div class="invalid-feedback"><%= errors.email.message %></div>
        <% } %>
      </div>

      <div class="alert alert-info">
        <div class="d-flex align-items-center">
          <i class="fas fa-info-circle me-2"></i>
          <div>
            <strong>Perubahan Password:</strong> Biarkan bidang password kosong jika tidak ingin mengubah password.
          </div>
        </div>
      </div>
      
      <div class="row">
        <!-- Password -->
        <div class="col-md-6 mb-3">
          <label for="password" class="form-label">Password Baru (Opsional)</label>
          <div class="input-group">
            <input type="password" class="form-control <%= locals.errors && errors.password ? 'is-invalid' : '' %>" 
                  id="password" name="password">
            <button class="btn btn-outline-secondary toggle-password" type="button" data-target="password">
              <i class="fas fa-eye"></i>
            </button>
            <% if (locals.errors && errors.password) { %>
              <div class="invalid-feedback"><%= errors.password.message %></div>
            <% } %>
          </div>
          <div class="form-text">Minimal 8 karakter, dengan huruf besar, huruf kecil, dan angka.</div>
        </div>
        
        <!-- Confirm Password -->
        <div class="col-md-6 mb-3">
          <label for="confirmPassword" class="form-label">Konfirmasi Password Baru</label>
          <div class="input-group">
            <input type="password" class="form-control <%= locals.errors && errors.confirmPassword ? 'is-invalid' : '' %>" 
                  id="confirmPassword" name="confirmPassword">
            <button class="btn btn-outline-secondary toggle-password" type="button" data-target="confirmPassword">
              <i class="fas fa-eye"></i>
            </button>
            <% if (locals.errors && errors.confirmPassword) { %>
              <div class="invalid-feedback"><%= errors.confirmPassword.message %></div>
            <% } %>
          </div>
        </div>
      </div>

      <div class="row">
        <!-- Role -->
        <div class="col-md-6 mb-3">
          <label for="role" class="form-label">Peran <span class="text-danger">*</span></label>
          <select class="form-select <%= locals.errors && errors.role ? 'is-invalid' : '' %>" 
                 id="role" name="role" required>
            <option value="user" <%= (locals.formData ? formData.role === 'user' : user.role === 'user') ? 'selected' : '' %>>User</option>
            <option value="admin" <%= (locals.formData ? formData.role === 'admin' : user.role === 'admin') ? 'selected' : '' %>>Admin</option>
            <option value="superadmin" <%= (locals.formData ? formData.role === 'superadmin' : user.role === 'superadmin') ? 'selected' : '' %>>Super Admin</option>
          </select>
          <% if (locals.errors && errors.role) { %>
            <div class="invalid-feedback"><%= errors.role.message %></div>
          <% } else { %>
            <div class="form-text">
              <span class="text-danger">Perhatian:</span> Peran Super Admin memiliki akses penuh ke semua fitur sistem.
            </div>
          <% } %>
        </div>
        
        <!-- Active Status -->
        <div class="col-md-6 mb-3">
          <label for="isActive" class="form-label">Status</label>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="isActive" name="isActive" 
                  <%= (locals.formData ? formData.isActive : user.isActive) ? 'checked' : '' %>>
            <label class="form-check-label" for="isActive">Aktif</label>
          </div>
          <div class="form-text">Pengguna tidak aktif tidak dapat login ke sistem.</div>
        </div>
      </div>

      <!-- Additional Information -->
      <div class="mb-4">
        <label for="notes" class="form-label">Catatan (Opsional)</label>
        <textarea class="form-control" id="notes" name="notes" rows="2"><%= locals.formData ? formData.notes : user.notes || '' %></textarea>
        <div class="form-text">Informasi tambahan atau catatan tentang pengguna ini.</div>
      </div>
      
      <!-- Last Updated -->
      <div class="mb-4">
        <div class="text-muted small">
          <div><strong>Dibuat pada:</strong> <%= new Date(user.createdAt).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %></div>
          <% if (user.updatedAt && user.updatedAt !== user.createdAt) { %>
            <div><strong>Terakhir diubah:</strong> <%= new Date(user.updatedAt).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %></div>
          <% } %>
          <% if (user.lastLogin) { %>
            <div><strong>Terakhir login:</strong> <%= new Date(user.lastLogin).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %></div>
          <% } %>
        </div>
      </div>

      <hr>
      
      <!-- Submit Button -->
      <div class="d-flex justify-content-between">
        <button type="reset" class="btn btn-light">
          <i class="fas fa-redo me-1"></i> Reset Form
        </button>
        <div>
          <a href="/superadmin/users/<%= user.id %>" class="btn btn-outline-secondary me-2">
            <i class="fas fa-eye me-1"></i> Lihat Detail
          </a>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-1"></i> Simpan Perubahan
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Password toggle visibility
    const toggleButtons = document.querySelectorAll('.toggle-password');
    toggleButtons.forEach(button => {
      button.addEventListener('click', function() {
        const targetId = this.getAttribute('data-target');
        const passwordInput = document.getElementById(targetId);
        
        if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          this.querySelector('i').classList.remove('fa-eye');
          this.querySelector('i').classList.add('fa-eye-slash');
        } else {
          passwordInput.type = 'password';
          this.querySelector('i').classList.remove('fa-eye-slash');
          this.querySelector('i').classList.add('fa-eye');
        }
      });
    });
    
    // Form validation
    const form = document.querySelector('.needs-validation');
    form.addEventListener('submit', function(event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      
      const password = document.getElementById('password');
      const confirmPassword = document.getElementById('confirmPassword');
      
      if (password.value !== '' && password.value !== confirmPassword.value) {
        confirmPassword.setCustomValidity('Passwords do not match');
        event.preventDefault();
        event.stopPropagation();
      } else {
        confirmPassword.setCustomValidity('');
      }
      
      form.classList.add('was-validated');
    });
  });
</script>
